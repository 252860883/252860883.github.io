{"version":3,"sources":["components/headerLink.tsx","article/用Proxy实现MVVM双向绑定.js"],"names":["Main","idName","dom","document","getElementById","window","scrollTo","top","offsetTop","left","behavior","_this","this","react__WEBPACK_IMPORTED_MODULE_5___default","a","createElement","className","props","headerLink","map","item","index","level","key","onClick","clickPosBtn","bind","title","React","Component","Template","Object","_Users_dinosaur_webtest_dinosaur_blog_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","_Users_dinosaur_webtest_dinosaur_blog_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_2__","_Users_dinosaur_webtest_dinosaur_blog_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_getPrototypeOf__WEBPACK_IMPORTED_MODULE_3__","call","state","_components_headerLink__WEBPACK_IMPORTED_MODULE_7__","id"],"mappings":"wMAEqBA,2OAGLC,GACR,IAAMC,EAAWC,SAASC,eAAeH,GACzCI,OAAOC,SAAS,CACZC,IAAKL,EAAIM,UAAY,GACrBC,KAAM,EACNC,SAAU,4CAIT,IAAAC,EAAAC,KACL,OACIC,EAAAC,EAAAC,cAAA,OAAKC,UAAU,cACXH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,WACXH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,gBACXH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,OAAf,2BAEIJ,KAAKK,MAAMC,WAAWC,IAAI,SAACC,EAAWC,GAClC,OAAOR,EAAAC,EAAAC,cAAA,QAAMC,UAAW,IAAMI,EAAKE,MAAOC,IAAKF,EAAOG,QAASb,EAAKc,YAAYC,KAAKf,EAAMS,EAAKO,QAASP,EAAKO,mBApB5GC,IAAMC,yLCCnBC,cACjB,SAAAA,IAAc,IAAAnB,EAAA,OAAAoB,OAAAC,EAAA,EAAAD,CAAAnB,KAAAkB,IACVnB,EAAAoB,OAAAE,EAAA,EAAAF,CAAAnB,KAAAmB,OAAAG,EAAA,EAAAH,CAAAD,GAAAK,KAAAvB,QACKwB,MAAQ,CACTlB,WAAY,CAAC,CAACI,MAAQ,KAAKK,MAAQ,SAAS,CAACL,MAAQ,KAAKK,MAAQ,kEAH5DhB,qHASV,OACIE,EAAAC,EAAAC,cAAA,WACIF,EAAAC,EAAAC,cAACsB,EAAA,EAAD,CAAYnB,WAAYN,KAAKwB,MAAMlB,aACnCL,EAAAC,EAAAC,cAAA,OAAKC,UAAU,WAC/BH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,iBAAgBH,EAAAC,EAAAC,cAAA,MAAIC,UAAU,SAAd,wDAC/BH,EAAAC,EAAAC,cAAA,kBACEF,EAAAC,EAAAC,cAAA,4GAAwBF,EAAAC,EAAAC,cAAA,uCAAxB,oOAGFF,EAAAC,EAAAC,cAAA,MAAIuB,GAAG,SAAP,SAEAzB,EAAAC,EAAAC,cAAA,uDAAWF,EAAAC,EAAAC,cAAA,qBAAX,+RAEAF,EAAAC,EAAAC,cAAA,WAAKF,EAAAC,EAAAC,cAAA,YAAMF,EAAAC,EAAAC,cAAA,aACXF,EAAAC,EAAAC,cAAA,6BAAqB,KACrBF,EAAAC,EAAAC,cAAA,+FACAF,EAAAC,EAAAC,cAAA,8CAAsC,KACtCF,EAAAC,EAAAC,cAAA,kEACAF,EAAAC,EAAAC,cAAA,sBACAF,EAAAC,EAAAC,cAAA,+FACAF,EAAAC,EAAAC,cAAA,oDAA4C,KAC5CF,EAAAC,EAAAC,cAAA,2BACAF,EAAAC,EAAAC,cAAA,qBACAF,EAAAC,EAAAC,cAAA,kBACAF,EAAAC,EAAAC,cAAA,aACAF,EAAAC,EAAAC,cAAA,iCAAyB,IAAzB,oNACAF,EAAAC,EAAAC,cAAA,aACAF,EAAAC,EAAAC,cAAA,yBACAF,EAAAC,EAAAC,cAAA,gCACAF,EAAAC,EAAAC,cAAA,aACAF,EAAAC,EAAAC,cAAA,yDACAF,EAAAC,EAAAC,cAAA,2DACAF,EAAAC,EAAAC,cAAA,eAGAF,EAAAC,EAAAC,cAAA,MAAIuB,GAAG,gEAAP,gEAEAzB,EAAAC,EAAAC,cAAA,qLAEAF,EAAAC,EAAAC,cAAA,kEAAYF,EAAAC,EAAAC,cAAA,yBAAZ,mGAAuDF,EAAAC,EAAAC,cAAA,mBAAvD,oJAEAF,EAAAC,EAAAC,cAAA,WAAKF,EAAAC,EAAAC,cAAA,YAAMF,EAAAC,EAAAC,cAAA,aACXF,EAAAC,EAAAC,cAAA,+BAAuB,KACvBF,EAAAC,EAAAC,cAAA,4BACAF,EAAAC,EAAAC,cAAA,iBACAF,EAAAC,EAAAC,cAAA,aACAF,EAAAC,EAAAC,cAAA,6BAAqB,KACrBF,EAAAC,EAAAC,cAAA,uDAA+C,KAC/CF,EAAAC,EAAAC,cAAA,gDACAF,EAAAC,EAAAC,cAAA,iDAAyC,KACzCF,EAAAC,EAAAC,cAAA,gDACAF,EAAAC,EAAAC,cAAA,yCAAiC,IAAjC,2BAA8D,IAA9D,iBAAiF,IAAjF,eACAF,EAAAC,EAAAC,cAAA,yBACAF,EAAAC,EAAAC,cAAA,qBACAF,EAAAC,EAAAC,cAAA,iBACAF,EAAAC,EAAAC,cAAA,0DACAF,EAAAC,EAAAC,cAAA,eAGAF,EAAAC,EAAAC,cAAA,2aAEAF,EAAAC,EAAAC,cAAA,WAAKF,EAAAC,EAAAC,cAAA,YAAMF,EAAAC,EAAAC,cAAA,aACXF,EAAAC,EAAAC,cAAA,uBACAF,EAAAC,EAAAC,cAAA,0DACAF,EAAAC,EAAAC,cAAA,aACAF,EAAAC,EAAAC,cAAA,qBACAF,EAAAC,EAAAC,cAAA,wFACAF,EAAAC,EAAAC,cAAA,yEACAF,EAAAC,EAAAC,cAAA,2CACAF,EAAAC,EAAAC,cAAA,+BAAuB,KACvBF,EAAAC,EAAAC,cAAA,oDAA+C,KAC/CF,EAAAC,EAAAC,cAAA,gEACAF,EAAAC,EAAAC,cAAA,8CAAsC,KACtCF,EAAAC,EAAAC,cAAA,4DACAF,EAAAC,EAAAC,cAAA,yEAAiE,KACjEF,EAAAC,EAAAC,cAAA,+DACAF,EAAAC,EAAAC,cAAA,8BACAF,EAAAC,EAAAC,cAAA,yBACAF,EAAAC,EAAAC,cAAA,sBACAF,EAAAC,EAAAC,cAAA,iBACAF,EAAAC,EAAAC,cAAA,sBACAF,EAAAC,EAAAC,cAAA,eAGAF,EAAAC,EAAAC,cAAA,ugBAEAF,EAAAC,EAAAC,cAAA,WAAKF,EAAAC,EAAAC,cAAA,YAAMF,EAAAC,EAAAC,cAAA,aACXF,EAAAC,EAAAC,cAAA,yJACAF,EAAAC,EAAAC,cAAA,uCAA+B,KAC/BF,EAAAC,EAAAC,cAAA,oDAA+C,KAC/CF,EAAAC,EAAAC,cAAA,mEAA2D,KAC3DF,EAAAC,EAAAC,cAAA,0DACAF,EAAAC,EAAAC,cAAA,yBACAF,EAAAC,EAAAC,cAAA,sBACAF,EAAAC,EAAAC,cAAA,iBACAF,EAAAC,EAAAC,cAAA,aACAF,EAAAC,EAAAC,cAAA,6DACAF,EAAAC,EAAAC,cAAA,6BAAqB,KACrBF,EAAAC,EAAAC,cAAA,uDAA+C,KAC/CF,EAAAC,EAAAC,cAAA,gDACAF,EAAAC,EAAAC,cAAA,iDAAyC,KACzCF,EAAAC,EAAAC,cAAA,yCAAiC,IAAjC,2BAA8D,IAA9D,iBAAiF,IAAjF,eACAF,EAAAC,EAAAC,cAAA,gDACAF,EAAAC,EAAAC,cAAA,iEACAF,EAAAC,EAAAC,cAAA,0CACAF,EAAAC,EAAAC,cAAA,yBACAF,EAAAC,EAAAC,cAAA,qBACAF,EAAAC,EAAAC,cAAA,iBACAF,EAAAC,EAAAC,cAAA,eAGAF,EAAAC,EAAAC,cAAA,+KAEAF,EAAAC,EAAAC,cAAA,WAAKF,EAAAC,EAAAC,cAAA,YAAMF,EAAAC,EAAAC,cAAA,aACXF,EAAAC,EAAAC,cAAA,gCAA2B,KAC3BF,EAAAC,EAAAC,cAAA,qCACAF,EAAAC,EAAAC,cAAA,wBACAF,EAAAC,EAAAC,cAAA,eAGAF,EAAAC,EAAAC,cAAA,6IAEAF,EAAAC,EAAAC,cAAA,kBACEF,EAAAC,EAAAC,cAAA,yHArIoCa,IAAMC","file":"static/js/50.80a684b6.chunk.js","sourcesContent":["import React from 'react'\nimport \"../style/components/headerLink.scss\"\nexport default class Main extends React.Component<any, any>{\n    componentDidMount() { }\n\n    clickPosBtn(idName: string) {\n        const dom: any = document.getElementById(idName);\n        window.scrollTo({\n            top: dom.offsetTop - 10,\n            left: 0,\n            behavior: 'smooth'\n        });\n    }\n\n    render() {\n        return (\n            <div className=\"headerLink\">\n                <div className=\"content\">\n                    <div className=\"real-content\">\n                        <div className='tag'>Reading Assistance ·</div>\n                        {\n                            this.props.headerLink.map((item: any, index: number) => {\n                                return <span className={'a' + item.level} key={index} onClick={this.clickPosBtn.bind(this, item.title)}>{item.title}</span>\n                            })\n                        }\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}","import React from 'react'\nimport '../style/main.scss'\nimport HeaderLink from \"../components/headerLink\"\nexport default class Template extends React.Component {\n    constructor() {\n        super();\n        this.state = {\n            headerLink: [{\"level\":\"h3\",\"title\":\"Proxy\"},{\"level\":\"h3\",\"title\":\"实现一个简单的 MVVM 框架\"}]\n        }\n    }\n    componentDidMount() {\n    }\n    render() {\n        return (\n            <div>\n                <HeaderLink headerLink={this.state.headerLink}></HeaderLink>\n                <div className=\"article\">\n<div className=\"title-content\"><h1 className=\"title\">用Proxy实现MVVM双向绑定</h1></div>\n<blockquote>\n  <p>在之前我们了解到 VUE 的框架底层通过 <code>Object.defineProperty()</code> 来实现双向绑定的。那这次咱们就来玩点不一样的，用 ES6 的 Proxy 来实现 MVVM 的双向绑定。</p>\n</blockquote>\n\n<h3 id='Proxy'>Proxy</h3>\n\n<p>首先来了解一下 <code>Proxy</code> ，该对象用于定义基本操作的自定义行为（如属性查找，赋值，枚举，函数调用等）。看下面的基础示例：</p>\n\n<pre><code><span></span>\n<span>let handler = {'{'}</span>\n<span>    // 获取属性时执行的回调函数</span>\n<span>    get: function(target, name){'{'}</span>\n<span>        return name in target ? target[name] : 37;</span>\n<span>    },</span>\n<span>    // 设置属性时执行的回调函数</span>\n<span>    set: function (obj, prop, value) {'{'}</span>\n<span>        ...</span>\n<span>    }</span>\n<span>};</span>\n<span></span>\n<span>let p = new Proxy({'{'}}, handler); // 第一个参数为被包装的目标对象，第二个参数为各种操作回调函数的集合</span>\n<span></span>\n<span>p.a = 1; </span>\n<span>p.b = undefined;</span>\n<span></span>\n<span>console.log(p.a, p.b);    // 1, undefined</span>\n<span>console.log('c' in p, p.c);    // false, 37</span>\n<span></span>\n</code></pre>\n\n<h3 id='实现一个简单的 MVVM 框架'>实现一个简单的 MVVM 框架</h3>\n\n<p>好了，有了这个前提，我们就可以开始封装我们的“框架”了。</p>\n\n<p>首先，我们创建一个<code>viewModel</code>对象,并将其赋值为一个Proxy对象，设置<code>set</code>回调函数，当属性值被修改时便可以执行对应的操作。</p>\n\n<pre><code><span></span>\n<span>let viewModel = {'{'}</span>\n<span>    a: \"111\"</span>\n<span>}</span>\n<span></span>\n<span>let handler = {'{'}</span>\n<span>    set: function (obj, prop, newValue) {'{'}</span>\n<span>        let oldValue = obj[prop]</span>\n<span>        if (oldValue != newValue) {'{'}</span>\n<span>            obj[prop] = newValue</span>\n<span>            console.log(`${'{'}prop} is changing from ${'{'}oldValue} to ${'{'}newValue}`)</span>\n<span>        }</span>\n<span>    }</span>\n<span>}</span>\n<span>viewModel = new Proxy(viewModel, handler);</span>\n<span></span>\n</code></pre>\n\n<p>然后我们进行单向绑定，将我们的dom中的value值和viewModel进行绑定，当value值变化时，viewModel会自动进行更新。这里我们模拟dom元素中的model属性值对应绑定viewModel中的属性值。</p>\n\n<pre><code><span></span>\n<span>// html</span>\n<span>&lt;input id='input' type=\"text\" model=\"a\"&gt;</span>\n<span></span>\n<span>// js</span>\n<span>// 获取所有需要绑定的dom元素</span>\n<span>let modelElements = document.querySelectorAll('[model]');</span>\n<span>// 绑定事件</span>\n<span>function init() {'{'}</span>\n<span>    modelElements.forEach(element =&gt; {'{'}</span>\n<span>        let prop = element.getAttribute('model')</span>\n<span>        if (prop in viewModel) {'{'}</span>\n<span>            element.value = viewModel[prop];</span>\n<span>            element.addEventListener('keyup', function () {'{'}</span>\n<span>                viewModel[prop] = element.value</span>\n<span>            })</span>\n<span>        }</span>\n<span>    })</span>\n<span>}</span>\n<span>init()</span>\n<span></span>\n</code></pre>\n\n<p>这样当我们修改 input 的值的时候，控制台就会输出日志，viewModel对应的属性值会同步更新。下面我们继续进行另一向的绑定：当修改 viewModel 的属性值，对应绑定的 dom 元素的值也会发生变化。代码如下：</p>\n\n<pre><code><span></span>\n<span>// 当 viewModel 的某个属性被修改时，动态修改被绑定的dom值</span>\n<span>function setValue(prop) {'{'}</span>\n<span>    modelElements.forEach(element =&gt; {'{'}</span>\n<span>        if (element.getAttribute('model') === prop) {'{'}</span>\n<span>            element.value= viewModel[prop]</span>\n<span>        }</span>\n<span>    })</span>\n<span>}</span>\n<span></span>\n<span>// 修改 handler 的set函数</span>\n<span>let handler = {'{'}</span>\n<span>    set: function (obj, prop, newValue) {'{'}</span>\n<span>        let oldValue = obj[prop]</span>\n<span>        if (oldValue != newValue) {'{'}</span>\n<span>            console.log(`${'{'}prop} is changing from ${'{'}oldValue} to ${'{'}newValue}`)</span>\n<span>            obj[prop] = newValue</span>\n<span>            // 添加 setValue 函数</span>\n<span>            setValue(prop)</span>\n<span>        }</span>\n<span>    }</span>\n<span>}</span>\n<span></span>\n</code></pre>\n\n<p>这样，双向绑定就完成啦，我们可以添加一个 setTimeout 进行验证：</p>\n\n<pre><code><span></span>\n<span>setTimeout(() =&gt; {'{'}</span>\n<span>    viewModel.a = 233</span>\n<span>}, 1000)</span>\n<span></span>\n</code></pre>\n\n<p>一秒中后，input中的值由 ‘111’ 变为 ‘233’。成功～</p>\n\n<blockquote>\n  <p>完整代码：https://github.com/MagicalDinosaur/demos/blob/master/proxy/mvvm.html</p>\n</blockquote>\n</div>\n            </div>\n\n        )\n    }\n}"],"sourceRoot":""}